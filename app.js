"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),express=require("express"),path=require("path"),session=require("express-session");require("./model/connect");var app=express(),logR=require("./route/route-log"),stuR=require("./route/route-stu"),userR=require("./route/route-user");app.use(express.static(path.join(__dirname,"public"))),app.use(session({secret:"keyboard cat",saveUninitialized:!1,cookie:{maxAge:864e5}})),app.use("/",function(){var s=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t,s){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.url;case 2:if(e.t1=e.sent,e.t0="/log/login"!=e.t1,!e.t0){e.next=6;break}e.t0=!r.session.userid;case 6:if(!e.t0){e.next=8;break}t.redirect(301,"/log/login");case 8:s();case 9:case"end":return e.stop()}},e)}));return function(e,r,t){return s.apply(this,arguments)}}()),app.use("/user",function(){var s=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t,s){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.session.role;case 2:if(e.t0=e.sent,"admin"==e.t0){e.next=5;break}t.redirect(301,"/stu");case 5:s();case 6:case"end":return e.stop()}},e)}));return function(e,r,t){return s.apply(this,arguments)}}()),app.use("/log",logR),app.use("/stu",stuR),app.use("/user",userR),app.listen("80"),console.log("服务器已启动");