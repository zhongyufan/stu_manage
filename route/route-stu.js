"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),express=require("express"),stu=express.Router(),path=require("path"),student=require("../model/student"),bodyParser=require("body-parser");stu.use(bodyParser.urlencoded({extended:!1}));var root=path.resolve(__dirname,"..");stu.get("/",function(e,t){t.sendFile(path.join(root,"views","student","list.html"))}),stu.get("/list",function(e,t){t.sendFile(path.join(root,"views","student","list.html"))}),stu.get("/add",function(e,t){t.sendFile(path.join(root,"views","student","add.html"))}),stu.get("/updata",function(e,t){t.sendFile(path.join(root,"views","student","updata.html"))}),stu.get("/listresult",function(t,r){student.find().then(function(e){r.send({result:e,userInfo:{id:t.session.userid,name:t.session.name,image:t.session.image,role:t.session.role}})}).catch(function(e){console.log("查询失败"+e)})}),stu.get("/updataresult",function(e,t){var r=e.query.id;student.findOne({_id:r}).then(function(e){t.send(e)}).catch(function(e){console.log("查询失败"+e)})}),stu.post("/addStuInfo",function(){var r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t,r){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,student.create(t.body);case 2:r.redirect(301,"/stu/list");case 3:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}}()),stu.post("/updataStuInfo",function(){var r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t,r){var n;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.query.id,e.next=3,student.updateMany({_id:n},t.body);case 3:r.redirect(301,"/stu/list");case 4:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}}()),stu.get("/deleteInfo",function(){var r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t,r){var n;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.query.id,e.next=3,student.findOneAndDelete({_id:n});case 3:r.redirect(301,"/stu/list");case 4:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}}()),module.exports=stu;